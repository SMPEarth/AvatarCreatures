/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'java'
    id 'maven-publish'
    id 'io.freefair.lombok' version '5.3.0' apply false
    id "com.github.johnrengelman.shadow" version "6.1.0"
}

repositories {
    mavenLocal()
    maven {
        url = uri('http://repo.volmit.com/repository/volmit/')
    }
    maven {
        url = uri('https://repo.maven.apache.org/maven2/')
    }
}

dependencies {
    implementation 'org.bstats:bstats-bukkit:1.7'
    implementation 'com.zaxxer:HikariCP:3.4.5'
    compileOnly 'org.spigotmc:spigot-api:1.16.4-R0.1-SNAPSHOT'
    compileOnly 'org.bukkit.craftbukkit:1.16.4:1.16.4'
    compileOnly 'com.comphenix.protocol:ProtocolLib:4.5.1'
    compileOnly 'org.jetbrains:annotations:17.0.0'
    compileOnly 'com.github.TownyAdvanced:Towny:0.96.2.0'
}

group = 'me.relavis.avatarcreatures'
version = '1.1.6'
java.sourceCompatibility = JavaVersion.VERSION_1_8
compileJava.options.encoding = "UTF-8"
compileJava.options.compilerArgs += ["-parameters"]
compileJava.options.fork = true
compileJava.options.forkOptions.executable = 'javac'
compileTestJava.options.encoding = "UTF-8"


publishing {
    publications {
        maven(MavenPublication) {
            from(components.java)
        }
    }
}


processResources {
    filesMatching("plugin.yml") {
        expand("version": project.version)
    }
}

String finalJarName = project.name + "-" + project.version;
String finalJarPath = jar.archiveFile.get().getAsFile().getParentFile().getParentFile().getParentFile().getAbsolutePath() + "\\release\\" + project.version + "\\" + finalJarName + ".jar";

shadowJar {
    dependencies {
        include dependency('com.zaxxer:HikariCP')
        include dependency('org.bstats:bstats-bukkit')
        include dependency('co.aikar:acf-paper')
    }
    dependencies {
        relocate('com.zaxxer.hikari', project.group + ".libraries.hikaricp")
        relocate('org.bstats.bukkit', project.group + '.libraries.bstats')
        relocate('co.aikar.commands', project.group + 'libraries.acf')
        relocate('co.aikar.locales', project.group + 'libraries.acf.locales')
    }
    zip64 true
    minimize()
    project.configurations.implementation.canBeResolved = true
    project.configurations.runtime.canBeResolved = true
    project.configurations.compile.canBeResolved = true
    archiveFileName = finalJarPath
}

task buildRelease {
    group 'AvatarCreatures'
    dependsOn 'shadowJar'
    file(jar.archiveFile.get().getAsFile().getParentFile().getParentFile().getParentFile().getParentFile().getAbsolutePath() + '/build/resources/main/plugin.yml').delete();
}

tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
}
